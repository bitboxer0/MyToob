# Story 1.1 Implementation Guide: Xcode Project Setup

**Estimated Time:** 4-6 hours
**Difficulty:** Medium
**Prerequisites:** Xcode 15+, macOS 14+

---

## Step-by-Step Implementation

### Step 1: Create New Xcode Project (30 mins)

**Actions:**
```bash
# Navigate to your projects directory
cd ~/projects/App\ Projects/

# Xcode will create the MyToob directory
```

**In Xcode:**
1. Open Xcode
2. File â†’ New â†’ Project
3. Select **macOS** â†’ **App**
4. Configure project:
   - **Product Name:** MyToob
   - **Team:** Your Apple Developer Team
   - **Organization Identifier:** com.yourcompany (or your domain)
   - **Bundle Identifier:** com.yourcompany.mytoob
   - **Interface:** SwiftUI
   - **Language:** Swift
   - **Storage:** SwiftData (if option available, otherwise add later)
   - **Include Tests:** âœ“ (check both Unit and UI tests)
5. Click **Next**, choose location, click **Create**

**Verify:**
- Project builds: âŒ˜B
- Project runs: âŒ˜R (should show empty window)

---

### Step 2: Configure Deployment Target & Build Settings (15 mins)

**In Xcode Project Navigator:**
1. Click project name (blue icon at top)
2. Select **MyToob** target (under TARGETS)
3. **General** tab:
   - **Minimum Deployments:** macOS 14.0
   - **Supports:** Mac (Apple silicon, Intel)

4. **Build Settings** tab:
   - Search for "optimization"
   - **Debug:** Optimization Level = None [-O0]
   - **Release:** Optimization Level = Optimize for Speed [-O]

**Verify:**
- Build Settings show macOS 14.0 minimum deployment

---

### Step 3: Configure Build Configurations (30 mins)

**Create TestFlight Configuration:**

1. Project Settings â†’ **Info** tab
2. Configurations section â†’ Click **+** â†’ Duplicate "Release" Configuration
3. Rename to **TestFlight**

4. **Build Settings** for each configuration:
   - **Debug:**
     - Swift Compiler - Code Generation â†’ Optimization Level: None [-O0]
     - Debug Information Format: DWARF with dSYM

   - **Release:**
     - Swift Compiler - Code Generation â†’ Optimization Level: Optimize for Speed [-O]
     - Debug Information Format: DWARF with dSYM

   - **TestFlight:**
     - Same as Release
     - (Will differentiate later with preprocessor flags if needed)

**Verify:**
- You can select Debug/Release/TestFlight from scheme dropdown

---

### Step 4: Configure App Sandbox & Entitlements (45 mins)

**Enable App Sandbox:**

1. Select **MyToob** target
2. **Signing & Capabilities** tab
3. Click **+ Capability**
4. Add **App Sandbox**

5. In App Sandbox settings, enable:
   - âœ“ Outgoing Connections (Client)
   - âœ“ User Selected Files (Read/Write)

**Create Entitlements File:**

Xcode should auto-create `MyToob/MyToob.entitlements`. Verify it contains:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>com.apple.security.app-sandbox</key>
    <true/>
    <key>com.apple.security.network.client</key>
    <true/>
    <key>com.apple.security.files.user-selected.read-write</key>
    <true/>
</dict>
</plist>
```

**Configure App Group (for future extensions):**

1. **Signing & Capabilities** â†’ **+ Capability** â†’ **App Groups**
2. Click **+** to add group: `group.com.yourcompany.mytoob`
3. (May need to register in Apple Developer portal first)

**Verify:**
- Entitlements file exists in project
- App Sandbox shows in Signing & Capabilities

---

### Step 5: Configure Code Signing (30 mins)

**Automatic Signing (Recommended for Development):**

1. **Signing & Capabilities** tab
2. âœ“ **Automatically manage signing**
3. Select your **Team** from dropdown
4. Xcode will create provisioning profiles automatically

**Manual Signing (For Production):**

1. In Apple Developer Portal:
   - Create App ID: com.yourcompany.mytoob
   - Create Distribution Certificate
   - Create Provisioning Profiles (Development, Distribution)

2. In Xcode:
   - Uncheck "Automatically manage signing"
   - Select provisioning profiles for Debug/Release

**For Now:** Use automatic signing for development

**Verify:**
- No signing errors in Signing & Capabilities
- Project builds without signing warnings

---

### Step 6: Configure Info.plist (20 mins)

**Edit Info.plist keys:**

1. Select **Info** tab in project settings
2. Add/modify keys (click **+** on any row):

**Required Keys:**
```
LSMinimumSystemVersion: 14.0
CFBundleDisplayName: MyToob
NSHumanReadableCopyright: Copyright Â© 2024 Your Company. All rights reserved.
```

**Add Custom Keys:**
- Right-click in Info tab â†’ Add Row
- Or edit `MyToob/Info.plist` directly:

```xml
<key>LSMinimumSystemVersion</key>
<string>14.0</string>
<key>CFBundleDisplayName</key>
<string>MyToob</string>
<key>NSHumanReadableCopyright</key>
<string>Copyright Â© 2024 Your Company. All rights reserved.</string>
<key>LSApplicationCategoryType</key>
<string>public.app-category.productivity</string>
```

**Verify:**
- Info.plist contains all required keys
- LSMinimumSystemVersion = 14.0

---

### Step 7: Add Core ML Model (30 mins)

**Download/Obtain Model:**

For now, we'll create a placeholder. The actual model will be added later.

**Create Resources Directory Structure:**

1. In Xcode Project Navigator, right-click **MyToob** folder
2. New Group â†’ Name it **Resources**
3. Right-click **Resources** â†’ New Group â†’ Name it **CoreML Models**

**Add Placeholder (for now):**

Since you may not have the actual `sentence-transformer-384.mlpackage` yet:

1. Create a text file noting the model requirement:
   - Right-click **CoreML Models** folder
   - New File â†’ Empty
   - Name: `MODEL_PLACEHOLDER.md`

2. Add content:
```markdown
# Core ML Model Placeholder

**Required Model:** sentence-transformer-384.mlpackage

**Specifications:**
- Input: Text string (max 256 tokens)
- Output: 384-dimensional Float array
- Format: Core ML .mlpackage
- Quantization: 8-bit

**TODO:** Add actual Core ML model file here before implementing Epic 7
```

**When you have the actual model:**
- Drag `.mlpackage` file into **CoreML Models** folder
- Ensure "Copy items if needed" is checked
- Target membership: MyToob (checked)

**Verify:**
- Resources/CoreML Models/ directory exists
- Placeholder file is in target membership

---

### Step 8: Set Up Project Structure (45 mins)

**Create Folder Structure:**

In Xcode, create these groups (folders) under **MyToob**:

```
MyToob/
â”œâ”€â”€ MyToobApp.swift (already exists)
â”œâ”€â”€ App/
â”‚   â”œâ”€â”€ ContentView.swift (move existing here)
â”‚   â””â”€â”€ (will add more later)
â”œâ”€â”€ Features/
â”‚   â”œâ”€â”€ YouTube/
â”‚   â”œâ”€â”€ LocalFiles/
â”‚   â”œâ”€â”€ AI/
â”‚   â”œâ”€â”€ Search/
â”‚   â”œâ”€â”€ Collections/
â”‚   â”œâ”€â”€ Notes/
â”‚   â””â”€â”€ FocusMode/
â”œâ”€â”€ Core/
â”‚   â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ Repositories/
â”‚   â”œâ”€â”€ Networking/
â”‚   â”œâ”€â”€ Security/
â”‚   â”œâ”€â”€ Utilities/
â”‚   â”‚   â””â”€â”€ Extensions/
â”‚   â””â”€â”€ MacOSIntegration/
â”œâ”€â”€ Resources/
â”‚   â”œâ”€â”€ Assets.xcassets/ (already exists)
â”‚   â”œâ”€â”€ CoreML Models/
â”‚   â”œâ”€â”€ Localizable/
â”‚   â””â”€â”€ HTML/
â””â”€â”€ Views/
    â”œâ”€â”€ Components/
    â”œâ”€â”€ Library/
    â”œâ”€â”€ Player/
    â””â”€â”€ Search/
```

**How to Create Groups:**
1. Right-click **MyToob** folder in navigator
2. New Group â†’ Name it (e.g., "App")
3. Repeat for all folders above
4. Drag `ContentView.swift` into **App** folder

**Verify:**
- All folders created
- Project still builds (âŒ˜B)
- ContentView.swift moved to App/

---

### Step 9: Configure Git & .gitignore (20 mins)

**Initialize Git (if not done):**

```bash
cd ~/projects/App\ Projects/MyToob
git init
```

**Create .gitignore:**

Create file at project root:

```bash
cat > .gitignore << 'EOF'
# Xcode
*.xcodeproj/*
!*.xcodeproj/project.pbxproj
!*.xcodeproj/xcshareddata/
*.xcworkspace/*
!*.xcworkspace/contents.xcworkspacedata
*.xcuserdata
*.xcuserdatad
xcuserdata/
DerivedData/
.DS_Store
*.moved-aside
*.pbxuser
!default.pbxuser
*.mode1v3
!default.mode1v3
*.mode2v3
!default.mode2v3
*.perspectivev3
!default.perspectivev3

# Swift Package Manager
.build/
Packages/
Package.resolved

# CocoaPods (if used later)
Pods/

# Secrets
.env
*.env
secrets.plist

# Build artifacts
build/
*.app
*.dSYM.zip
*.dSYM

# Other
*.swp
*~.nib
*.hmap
*.ipa
EOF
```

**Create .env.example:**

```bash
cat > .env.example << 'EOF'
# Google OAuth (YouTube Data API)
GOOGLE_OAUTH_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_OAUTH_CLIENT_SECRET=your-client-secret

# YouTube Data API Key
YOUTUBE_API_KEY=your-api-key

# CloudKit Container ID
CLOUDKIT_CONTAINER_ID=iCloud.com.yourcompany.mytoob

# App Store Connect API (for CI/CD)
APP_STORE_CONNECT_API_KEY=your-api-key
EOF
```

**Verify:**
- .gitignore exists
- .env.example exists
- .env in .gitignore (don't commit secrets!)

---

### Step 10: Verify Build & Launch (15 mins)

**Final Verification Checklist:**

```bash
# Clean build folder
âŒ˜â‡§K (or Product â†’ Clean Build Folder)

# Build project
âŒ˜B

# Run project
âŒ˜R
```

**Expected Result:**
- âœ“ Project builds without errors
- âœ“ App launches
- âœ“ Empty window appears with "Hello, World!" or basic content
- âœ“ No console errors

**Test Different Configurations:**
1. Scheme dropdown â†’ Select **Debug** â†’ Run
2. Scheme dropdown â†’ Select **Release** â†’ Run
3. Both should build and launch successfully

---

### Step 11: Update Story Status (10 mins)

**Mark Story as Complete:**

Edit `docs/stories/1.1.xcode-project-setup.md`:

```markdown
## Status
Done

## Dev Agent Record

### Agent Model Used
Manual Implementation (Human Developer)

### Debug Log References
None (clean build)

### Completion Notes List
- Xcode project created successfully
- All entitlements configured
- Code signing working (automatic)
- Build configurations: Debug, Release, TestFlight
- Project structure matches architecture/unified-project-structure.md
- .gitignore configured
- Core ML model placeholder added (actual model pending)

### File List
Created:
- MyToob.xcodeproj
- MyToob/MyToobApp.swift
- MyToob/App/ContentView.swift
- MyToob.entitlements
- MyToob/Resources/CoreML Models/MODEL_PLACEHOLDER.md
- .gitignore
- .env.example

Modified:
- Info.plist (added required keys)
```

---

## Common Issues & Solutions

### Issue 1: Signing Error
**Error:** "No signing certificate found"
**Solution:**
- Xcode â†’ Settings â†’ Accounts â†’ Add Apple ID
- Sign in with Apple Developer account
- Xcode will automatically fetch certificates

### Issue 2: Minimum Deployment Target Not Available
**Error:** macOS 14.0 not in dropdown
**Solution:**
- Update Xcode to version 15 or later
- Xcode 15 required for macOS 14 SDK

### Issue 3: App Sandbox Prevents Network Access
**Error:** Network requests fail
**Solution:**
- Verify `com.apple.security.network.client` in entitlements
- Check App Sandbox has "Outgoing Connections" enabled

### Issue 4: Core ML Model Not Found
**Error:** Model file not in bundle
**Solution:**
- Verify model file has target membership (MyToob checked)
- Clean build folder (âŒ˜â‡§K) and rebuild

---

## Acceptance Criteria Verification

Before marking story **Done**, verify all AC are met:

- [x] 1. Xcode project created for macOS target with macOS 14.0 minimum
- [x] 2. App sandbox enabled with network.client and user-selected files entitlements
- [x] 3. Signing configured (automatic for development)
- [x] 4. Build configurations: Debug, Release, TestFlight
- [x] 5. App group configured: group.com.yourcompany.mytoob
- [x] 6. Info.plist includes required keys
- [x] 7. Core ML model (placeholder) in Resources/CoreML Models/
- [x] 8. Project builds and launches with empty window

---

## Next Steps

After completing 1.1, **Team Alpha** should move to:
- **Story 1.4:** SwiftData Core Models (starts Day 3)
- **Story 1.5:** Basic App Shell & Navigation (starts Day 4)

**Team Bravo** can now start:
- **Story 1.2:** SwiftLint & Code Quality Tooling (starts Day 3)

**Team Charlie** can prepare:
- **Story 5.1:** Local File Import (starts Day 4 after 1.4)

---

## Time Tracking

**Estimated:** 4-6 hours
**Actual:** _____ hours

**Breakdown:**
- Step 1: 30 min
- Step 2: 15 min
- Step 3: 30 min
- Step 4: 45 min
- Step 5: 30 min
- Step 6: 20 min
- Step 7: 30 min
- Step 8: 45 min
- Step 9: 20 min
- Step 10: 15 min
- Step 11: 10 min

**Total:** ~4 hours (experienced) to 6 hours (first-time setup)

---

## Questions or Issues?

- Check architecture docs: `docs/architecture/`
- Review original story: `docs/stories/1.1.xcode-project-setup.md`
- Ask in Slack: `#mytoob-team-alpha`
- Escalate to Scrum Master if blocked >1 day

---

**Ready to code!** After completing this, Story 1.1 should be marked **Done** and you can move to Story 1.4 (SwiftData Core Models). ðŸš€
