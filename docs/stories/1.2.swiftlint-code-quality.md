# Story 1.2: SwiftLint & Code Quality Tooling

## Status
Draft

## Story
**As a** developer,
**I want** automated code quality checks enforced via SwiftLint and swift-format,
**so that** code style is consistent and policy violations (e.g., banned API usage) are caught at compile time.

## Acceptance Criteria
1. SwiftLint installed and integrated as Xcode build phase
2. `.swiftlint.yml` configuration file created with project-specific rules
3. Custom lint rule blocks usage of `googlevideo.com` in string literals (compliance enforcement)
4. Custom lint rule warns on hardcoded secrets/API keys patterns
5. swift-format installed for automated code formatting
6. Danger rules configured to check PRs for policy keywords and file changes
7. Build fails if critical lint violations found (errors, not warnings)

## Tasks / Subtasks
- [ ] Install SwiftLint (AC: 1)
  - [ ] Add SwiftLint installation instructions to README
  - [ ] Document installation via Homebrew: `brew install swiftlint`
- [ ] Integrate SwiftLint into Xcode build phase (AC: 1, 7)
  - [ ] Add "Run SwiftLint" build phase to target
  - [ ] Configure build phase to run before "Compile Sources"
  - [ ] Set build phase to fail build on errors
- [ ] Create SwiftLint configuration (AC: 2)
  - [ ] Create `.swiftlint.yml` in project root
  - [ ] Configure enabled/disabled rules
  - [ ] Set appropriate warning and error thresholds
  - [ ] Configure included/excluded paths
- [ ] Add custom compliance lint rules (AC: 3, 4)
  - [ ] Create custom rule to block `googlevideo.com` in string literals
  - [ ] Create custom rule to detect hardcoded API key patterns
  - [ ] Create custom rule to warn on hardcoded secrets patterns
  - [ ] Test custom rules with sample violations
- [ ] Install and configure swift-format (AC: 5)
  - [ ] Add swift-format installation instructions: `brew install swift-format`
  - [ ] Create `.swift-format` configuration file
  - [ ] Document formatting command in README
  - [ ] Add pre-commit hook recommendation for formatting
- [ ] Configure Danger for PR checks (AC: 6)
  - [ ] Create `Dangerfile` in project root
  - [ ] Add rule to check for policy violation keywords
  - [ ] Add rule to warn on changes to sensitive files
  - [ ] Add rule to enforce PR description requirements
  - [ ] Test Danger rules locally
- [ ] Verify build failure on critical violations (AC: 7)
  - [ ] Test that critical lint errors fail the build
  - [ ] Verify warnings don't fail the build
  - [ ] Document severity levels in contributing guidelines

## Dev Notes

### SwiftLint Integration
[Source: architecture/tech-stack.md]
- **Tool:** SwiftLint (latest version)
- **Purpose:** Code quality enforcement
- **Integration:** Xcode build phase, CI integration
- **Configuration:** Customizable rules

### swift-format Integration
[Source: architecture/tech-stack.md]
- **Tool:** swift-format (latest version)
- **Purpose:** Code formatting
- **Source:** Apple's official formatter
- **Goal:** Consistent code style

### Coding Standards to Enforce
[Source: architecture/coding-standards.md]

**Critical Rules to Enforce via Linting:**
- Never use `try!` except in unit tests
- Never call `SecItemAdd` directly (use `KeychainService` wrapper)
- Never use `ProcessInfo.processInfo.environment` directly in feature code
- Never make direct URLSession calls for YouTube API (use `YouTubeService`)
- Never leave players running in background
- Never load all Core ML models at app launch

**Compliance Rules:**
- Block usage of `googlevideo.com` in string literals (YouTube ToS violation)
- Warn on hardcoded API keys or secrets

### Build Phase Configuration
The SwiftLint build phase should:
1. Run before compilation
2. Use strict mode (warnings as errors for critical rules)
3. Generate reports for CI/CD pipeline
4. Fail build on critical violations

### Danger Configuration for PR Safety
Danger should check for:
- Changes to security-sensitive files (KeychainService, OAuth handlers)
- Policy violation keywords (stream, download, googlevideo)
- Missing PR descriptions or issue links
- Large file changes that might need extra review

## Testing

### Testing Standards
[Source: architecture/testing-strategy.md]
- **Test Framework:** XCTest
- **Test Organization:** MyToobTests/ directory

### Testing Requirements for This Story
- Create test files with intentional lint violations
- Verify SwiftLint catches violations correctly
- Test that build fails on critical errors
- Test that warnings don't fail build
- Verify custom rules work correctly

### Manual Verification Steps
1. Run `swiftlint` command in terminal
2. Build project in Xcode and verify lint phase runs
3. Add intentional violation and verify build fails
4. Check `.swiftlint.yml` is being used
5. Run `swift-format` on sample files
6. Test Danger rules with sample PR

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-11-17 | 1.0 | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_
