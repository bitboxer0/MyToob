# Story 1.3: GitHub CI/CD Pipeline

## Status
Draft

## Story
**As a** developer,
**I want** automated CI/CD via GitHub Actions that runs tests, linting, and builds on every commit,
**so that** code quality is enforced and broken builds are caught immediately.

## Acceptance Criteria
1. `.github/workflows/ci.yml` created with jobs: lint, test, build
2. Lint job runs SwiftLint and fails on errors
3. Test job runs `xcodebuild test` and reports coverage
4. Build job produces signed `.app` artifact
5. Workflow triggers on: push to main, pull requests
6. Workflow uses macOS runner (macos-latest or macos-14)
7. Build artifacts uploaded to GitHub Actions for debugging
8. All jobs pass on initial empty project

## Tasks / Subtasks
- [ ] Create GitHub Actions workflow directory (AC: 1)
  - [ ] Create `.github/workflows/` directory
  - [ ] Create `ci.yml` workflow file
- [ ] Configure workflow triggers (AC: 5)
  - [ ] Add trigger for push to main branch
  - [ ] Add trigger for pull requests
  - [ ] Optionally add manual workflow_dispatch trigger
- [ ] Implement lint job (AC: 2)
  - [ ] Configure job to run on macOS runner
  - [ ] Add checkout action
  - [ ] Install SwiftLint
  - [ ] Run SwiftLint with --strict flag
  - [ ] Configure job to fail on lint errors
- [ ] Implement test job (AC: 3)
  - [ ] Configure job to run on macOS runner
  - [ ] Add checkout action
  - [ ] Run xcodebuild test command
  - [ ] Configure test destination for macOS
  - [ ] Collect test coverage reports
  - [ ] Upload coverage reports to workflow artifacts
- [ ] Implement build job (AC: 4, 6)
  - [ ] Configure job to run on macOS runner (macos-14)
  - [ ] Add dependency on lint and test jobs
  - [ ] Add checkout action
  - [ ] Run xcodebuild build command
  - [ ] Configure Release configuration
  - [ ] Set up code signing (if needed for artifacts)
- [ ] Configure artifact upload (AC: 7)
  - [ ] Add upload-artifact action for built .app
  - [ ] Set appropriate retention period
  - [ ] Include debug symbols if applicable
- [ ] Test workflow execution (AC: 8)
  - [ ] Commit workflow file to repository
  - [ ] Verify workflow runs automatically
  - [ ] Check that all jobs pass
  - [ ] Verify artifacts are created
  - [ ] Test failure scenarios (intentional lint error)

## Dev Notes

### CI/CD Requirements
[Source: architecture/deployment-architecture.md]

**GitHub Actions Workflow Structure:**
```yaml
name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  lint:
    runs-on: macos-14
    steps:
      - uses: actions/checkout@v4
      - name: Run SwiftLint
        run: swiftlint --strict

  test:
    runs-on: macos-14
    steps:
      - uses: actions/checkout@v4
      - name: Run Tests
        run: xcodebuild test -scheme MyToob -destination 'platform=macOS'

  build:
    runs-on: macos-14
    needs: [lint, test]
    steps:
      - uses: actions/checkout@v4
      - name: Build Release
        run: xcodebuild -scheme MyToob -configuration Release build
      - name: Upload Artifact
        uses: actions/upload-artifact@v3
        with:
          name: MyToob.app
          path: build/Release/MyToob.app
```

### Tech Stack for CI/CD
[Source: architecture/tech-stack.md]
- **CI/CD Platform:** GitHub Actions
- **Justification:** Free for public repos, macOS runners available
- **Build Commands:** Standard xcodebuild commands

### Development Workflow Integration
[Source: architecture/development-workflow.md]

**Build Commands:**
- Lint: `swiftlint`
- Test: `xcodebuild test -scheme MyToob -destination 'platform=macOS'`
- Build: `xcodebuild -scheme MyToob -configuration Release build`

**Prerequisites Needed in CI:**
- Xcode 15+ with Command Line Tools
- SwiftLint (installed via Homebrew)

### Job Dependencies
- Build job should depend on successful completion of lint and test jobs
- This ensures code quality before building artifacts
- Saves CI minutes by failing fast on lint/test issues

### Artifact Management
- Upload built .app for debugging
- Include debug symbols for crash analysis
- Set reasonable retention period (e.g., 30 days)
- Artifacts available for download from GitHub Actions UI

## Testing

### Testing Standards
[Source: architecture/testing-strategy.md]
- **Test Framework:** XCTest
- **Test Command:** `xcodebuild test`
- **Test Organization:** MyToobTests/ directory

### Testing Requirements for This Story
- Verify workflow YAML syntax is valid
- Test workflow triggers correctly on push
- Test workflow triggers correctly on PR
- Verify all jobs execute in correct order
- Test that lint failures fail the workflow
- Test that test failures fail the workflow
- Verify artifacts are created and accessible

### Manual Verification Steps
1. Commit workflow file to GitHub
2. Create test PR and verify workflow runs
3. Check Actions tab for workflow execution
4. Verify all jobs show green checkmarks
5. Download artifact from Actions tab
6. Introduce lint error and verify workflow fails
7. Fix error and verify workflow passes

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-11-17 | 1.0 | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_
