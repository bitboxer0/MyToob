# Story 2.3: YouTube Data API Client Foundation

## Status
Draft

## Story
**As a** developer,
**I want** a strongly-typed API client for YouTube Data API v3 endpoints,
**so that** I can reliably fetch metadata with proper error handling.

## Acceptance Criteria
1. API client created using `URLSession` with async/await
2. Base URL configured: `https://www.googleapis.com/youtube/v3/`
3. API client automatically injects OAuth access token in `Authorization: Bearer` header
4. Typed request/response models created for key endpoints: `search.list`, `videos.list`, `channels.list`, `playlists.list`, `playlistItems.list`
5. Error handling for HTTP status codes: 401 (unauthorized, trigger token refresh), 403 (quota exceeded), 429 (rate limit), 5xx (server error)
6. API responses parsed into Swift structs (Codable)
7. Unit tests with mocked HTTP responses verify parsing and error handling

## Tasks / Subtasks
- [ ] Create YouTube API service (AC: 1, 2)
  - [ ] Create `MyToob/Features/YouTube/YouTubeService.swift`
  - [ ] Configure base URL constant
  - [ ] Initialize URLSession
  - [ ] Implement async request method
- [ ] Implement token injection (AC: 3)
  - [ ] Add Authorization header to all requests
  - [ ] Get access token from OAuth2Handler
  - [ ] Format as `Bearer {token}`
  - [ ] Check token expiry before requests
- [ ] Create Codable models (AC: 4, 6)
  - [ ] Create models directory structure
  - [ ] Define VideoListResponse model
  - [ ] Define SearchListResponse model
  - [ ] Define ChannelListResponse model
  - [ ] Define PlaylistListResponse model
  - [ ] Define PlaylistItemsResponse model
- [ ] Implement error handling (AC: 5)
  - [ ] Create YouTubeAPIError enum
  - [ ] Handle 401: trigger token refresh
  - [ ] Handle 403: quota exceeded error
  - [ ] Handle 429: rate limit error
  - [ ] Handle 5xx: server error
  - [ ] Log errors appropriately
- [ ] Create unit tests (AC: 7)
  - [ ] Test successful responses
  - [ ] Test error handling
  - [ ] Test token injection
  - [ ] Mock HTTP responses

## Dev Notes
[Source: architecture/external-apis.md, architecture/coding-standards.md]
- Base URL: `https://www.googleapis.com/youtube/v3/`
- Auth: OAuth 2.0 Bearer token
- Key endpoints: search.list (100 units), videos.list (1 unit), channels.list (1 unit)
- CRITICAL: Never make direct URLSession callsâ€”use YouTubeService wrapper
- File: `MyToob/Features/YouTube/YouTubeService.swift`

## Testing
[Source: architecture/testing-strategy.md]
- Test: `MyToobTests/Services/YouTubeServiceTests.swift`
- Mock network responses for unit tests
- Test error scenarios: 401, 403, 429, 5xx

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-11-17 | 1.0 | Initial story creation | Scrum Master (Bob) |
