# Story 12.3: Content Policy in Settings (About Section)

## Status
**Complete**

## Story
**As a** user,
**I want** to easily find and read MyToob's content policy from the Settings window,
**so that** I understand how content is moderated and what my options are for reporting or hiding content.

## Acceptance Criteria
- [x] Settings window accessible via standard macOS keyboard shortcut (Cmd-,)
- [x] About section displays app name and version
- [x] "Content Policy" button visible in Legal & Policies section
- [x] Content Policy button has proper accessibility identifiers and labels
- [x] Clicking button opens policy page in an in-app sheet (WKWebView)
- [x] Policy attempts to load from hosted URL first (https://yourwebsite.com/mytoob/content-policy)
- [x] Falls back to bundled HTML when remote URL fails to load
- [x] Compliance event logged when policy page is rendered (with source: external/local)
- [x] Policy sheet has title, source indicator, and Done button
- [x] Policy sheet can be dismissed with Done button
- [x] UI tests verify link visibility, opening, and content presence

## Implementation Summary

### Files Added
| File | Purpose |
|------|---------|
| `MyToob/Features/Settings/AboutView.swift` | Settings About view with app info and Content Policy button |
| `MyToob/Features/Settings/PolicyWebView.swift` | WKWebView wrapper with hosted URL + local fallback |
| `MyToob/Resources/ContentPolicy.html` | Bundled static HTML policy page for offline use |
| `MyToobUITests/ContentPolicyUITests.swift` | Comprehensive UI tests for the feature |

### Files Modified
| File | Changes |
|------|---------|
| `MyToob/MyToobApp.swift` | Added `Settings` scene to present AboutView |
| `MyToob/Core/Compliance/ComplianceLogger.swift` | Added `PolicyAccessSource` enum and `logContentPolicyAccessed(source:)` API |

### Key Accessibility Identifiers
- `SettingsAboutView` - The settings about view
- `AboutAppName` - App name text
- `OpenContentPolicyButton` - Content Policy button
- `ContentPolicyWebView` - The WKWebView displaying policy content
- `ContentPolicyTitle` - Policy page title
- `ContentPolicySourceLabel` - Indicator showing remote/local load source

### Compliance Logging
When the policy page is rendered, a compliance event is logged:
```
Content policy accessed: action=view_content_policy source=external|local timestamp=...
```

## Technical Notes

### Architecture Decisions
1. **In-app WKWebView** vs external browser: Used WKWebView to enable testable content verification and consistent macOS Settings UX
2. **Local fallback**: Bundled HTML ensures feature works offline and provides deterministic test behavior
3. **Compliance logging on render**: Logged when content actually displays, not on button tap, for accurate audit trail

### Testing Strategy
- UI tests use accessibility identifiers for stable element selection
- Tests verify Settings window opening (Cmd-,)
- Tests verify Content Policy button exists and is accessible
- Tests verify policy sheet opens with content
- Tests verify source label appears (indicating successful load)
- Tests verify Done button dismisses sheet

### Static HTML Policy Page
The bundled `ContentPolicy.html`:
- Supports Dark Mode via `prefers-color-scheme` media query
- Uses Apple system fonts for native feel
- Documents: YouTube content reporting, channel hiding, local files, AI features, prohibited uses
- Includes contact information and legal disclaimers

## Tasks / Subtasks
- [x] Create AboutView.swift with Form/Section layout
- [x] Create PolicyWebView.swift with NSViewRepresentable for WKWebView
- [x] Implement WKNavigationDelegate for load success/failure handling
- [x] Create ContentPolicy.html with full policy content
- [x] Add PolicyAccessSource enum and logging API to ComplianceLogger
- [x] Wire Settings scene in MyToobApp.swift
- [x] Create comprehensive UI tests
- [x] Add accessibility identifiers throughout

## Testing
- [x] `testSettingsWindowCanBeOpened` - Verifies Cmd-, opens settings
- [x] `testSettingsWindowContainsAboutView` - Verifies About view structure
- [x] `testContentPolicyButtonExists` - Verifies button presence and enabled state
- [x] `testContentPolicyButtonAccessibility` - Verifies accessibility label and hittability
- [x] `testContentPolicySheetOpens` - Verifies sheet opens on button click
- [x] `testContentPolicySheetHasTitle` - Verifies title presence
- [x] `testContentPolicySheetShowsSourceLabel` - Verifies load source indicator
- [x] `testContentPolicySheetHasDoneButton` - Verifies Done button presence
- [x] `testContentPolicySheetCanBeDismissed` - Verifies Done dismisses sheet
- [x] `testContentPolicyWebViewHasContent` - Verifies content loads
- [x] `testFullContentPolicyFlow` - End-to-end integration test

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-17 | 1.0 | Initial story creation | Scrum Master (Bob) |
| 2025-11-30 | 2.0 | Implementation complete | Claude Code (BMad Master) |
